<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    {% assign page_title_raw = page.title | default: '' %}
    {% assign clean_title = page_title_raw | split: ' --' | first %}
    {% if page.url == '/' %}
      <title>johnsy.com</title>
    {% elsif paginator.page and paginator.page > 1 %}
      <title>{{ clean_title }} - Page {{ paginator.page }} | johnsy.com</title>
    {% elsif page.title %}
      <title>{{ clean_title }} | johnsy.com</title>
    {% else %}
      <title>johnsy.com</title>
    {% endif %}
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#fafafa" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#121212" media="(prefers-color-scheme: dark)" />
    <link rel="manifest" href="/manifest.json" />

    <meta name="MSSmartTagsPreventParsing" content="TRUE" />
    {% assign page_description = page.description | default: site.description %}
    {% assign page_keywords = page.keywords %}
    <meta name="description" content="{{ page_description }}" />
    {% if page_keywords %}
    <meta name="keywords" content="{{ page_keywords | join: ', ' }}" />
    {% elsif site.keywords %}
    <meta name="keywords" content="{{ site.keywords | join: ', ' }}" />
    {% endif %}
    {% assign canonical_candidate = page.canonical_url | default: page.url %}
    {% if canonical_candidate %}
    <link rel="canonical" href="{{ canonical_candidate | absolute_url }}" />
    {% endif %}
    {% assign is_paginated_archive = false %}
    {% if paginator and paginator.page and paginator.page > 1 %}
      {% assign is_paginated_archive = true %}
    {% endif %}
    {% if page.pagefind_index == false or is_paginated_archive %}
    <meta name="pagefind-index" content="false" />
    {% endif %}

    <!-- Default icons -->
    <link rel="shortcut icon" href="{{ site.url }}/favicon.ico" />
    <link rel="icon" type="image/x-icon" sizes="64x64" href="{{ site.url }}/favicon.ico" />
    <link
      rel="apple-touch-icon"
      href="{{ site.url }}/icons/apple-touch-icon.png"
    />
    <link
      rel="apple-touch-icon-precomposed"
      href="{{ site.url }}/icons/apple-touch-icon-precomposed.png"
    />

    <!-- Sized apple touch icons -->
    {% for size in site.apple_touch_icon_sizes %}
    <link
      rel="apple-touch-icon"
      sizes="{{ size }}x{{ size }}"
      href="{{ site.url }}/icons/apple-touch-icon-{{ size }}x{{ size }}.png"
    />
    {% endfor %}

    <!-- Favicon icons -->
    {% for size in site.favicon_sizes %}
    <link
      rel="icon"
      type="image/png"
      sizes="{{ size }}x{{ size }}"
      href="{{ site.url }}/icons/favicon-{{ size }}x{{ size }}.png"
    />
    {% endfor %}

    <!-- Microsoft application metadata -->
    <meta name="application-name" content="{{ site.name }}" />
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta
      name="msapplication-TileImage"
      content="{{ site.url }}/icons/mstile-144x144.png"
    />

    {% for size in site.mstile_sizes %}
    <meta
      name="msapplication-{{ size.type }}"
      content="{{ site.url }}/icons/mstile-{{ size.dimensions }}.png"
    />
    {% endfor %}

    <meta property="og:description" content="{{ page_description }}" />

    {% include post-image-url.html item=page %}
    {% assign image_url = post_image_url %}

    {% include schema-person.html %}

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "url": {{ site.url | jsonify }},
      "name": {{ site.name | default: "johnsy.com" | jsonify }},
      "description": {{ site.description | default: "" | jsonify }},
      "publisher": {
        "@type": "Person",
        "name": {{ site.author.name | default: "" | jsonify }},
        "url": {{ site.author.url | default: "" | jsonify }}
      },
      "image": {{ image_url | default: "" | jsonify }}
    }
    </script>
    
    <meta property="og:title" content="{{ page.title }}" />
    <meta property="og:url" content="{{ site.url }}{{ page.url }}" />
    {% if page.date %}
    <meta property="og:type" content="article" />
    {% else %}
    <meta property="og:type" content="website" />
    {% endif %}
    <meta property="og:site_name" content="{{ site.name }}" />
    <meta property="og:image" content="{{ image_url }}" />
    {% if page.og_image_alt %}
    <meta property="og:image:alt" content="{{ page.og_image_alt }}" />
    {% endif %}

    {% if page.date %}
    <meta
      property="article:published_time"
      content="{{ page.date | date: '%Y-%m-%d %H:%M:%S' }}"
    />
    {% endif %} {% if page.updated %}
    <meta
      property="og:title"
      content="{{ page.title }} (updated {{ page.updated | date: '%Y-%m-%d %H:%M:%S' }})"
    />
    <meta
      property="article:modified_time"
      content="{{ page.updated | date: '%Y-%m-%d %H:%M:%S' }}"
    />
    {% endif %}

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="{{ page.title }}" />
    <meta name="twitter:description" content="{{ page_description }}" />
    <meta name="twitter:image" content="{{ image_url }}" />

    {% if page.date %}
    <meta
      name="twitter:data1"
      content="Published: {{ page.date | date: '%Y-%m-%d %H:%M:%S' }}"
    />
    {% endif %} {% if page.updated %}
    <meta
      name="twitter:title"
      content="{{ page.title }} (updated {{ page.updated | date: '%Y-%m-%d %H:%M:%S' }})"
    />
    <meta
      name="twitter:data2"
      content="Updated: {{ page.updated | date: '%Y-%m-%d %H:%M:%S' }}"
    />
    {% endif %}

    
    <link rel="preload" href="{{ site.url }}/assets/fonts/Atkinson-Hyperlegible-Regular.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="{{ site.url }}/assets/fonts/Atkinson-Hyperlegible-Bold.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="{{ site.url }}/assets/fonts/Atkinson-Hyperlegible-Italic.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="{{ site.url }}/assets/fonts/Atkinson-Hyperlegible-BoldItalic.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="{{ site.url }}/assets/fonts/Atkinson-Hyperlegible-Mono-Regular.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="{{ site.url }}/assets/fonts/Atkinson-Hyperlegible-Mono-Bold.woff2" as="font" type="font/woff2" crossorigin>

    <link rel="preload" href="{{ '/assets/css/style.min.css' | relative_url }}" as="style">
    <link rel="preload" href="{{ '/assets/css/colors-light.min.css' | relative_url }}" as="style" media="(prefers-color-scheme: light)">
    <link rel="preload" href="{{ '/assets/css/colors-dark.min.css' | relative_url }}" as="style" media="(prefers-color-scheme: dark)">
    <link
      href="{{ '/assets/css/style.min.css' | relative_url }}"
      rel="stylesheet"
    />
    <link
      href="{{ '/assets/css/colors-light.min.css' | relative_url }}"
      rel="stylesheet"
      media="(prefers-color-scheme: light)"
    />
    <link
      href="{{ '/assets/css/colors-dark.min.css' | relative_url }}"
      rel="stylesheet"
      media="(prefers-color-scheme: dark)"
    />

    <link rel="Start" href="{{ site.url }}/" title="Back to the start" />
    <link
      rel="Help"
      href="{{ site.url }}/about/"
      title="What is the point of this website?"
    />
    <link
      rel="alternate"
      type="text/xml"
      title="Atom"
      href="{{ site.url }}/feed.xml"
    />
  </head>

  <body>
    <a href="#content" class="skip-link">Skip to main content</a>
    <header id="header">
      <h1><a href="{{ site.url }}/">{{ site.name }}</a></h1>
      <p>{{ site.description_html }}</p>
    </header>

    <div id="page">
      <div id="sidebar">
        <nav aria-label="Main navigation">
          <ul class="main-nav">
            {% for nav in site.data.navigation %}
              {% assign is_current = false %}
              {% if page.url == nav.url %}
                {% assign is_current = true %}
              {% elsif nav.url != '/' %}
                {% if page.url contains nav.url %}
                  {% assign is_current = true %}
                {% endif %}
              {% endif %}
              <li>
                <a
                  href="{{ site.url }}{{ nav.url }}"
                  accesskey="{{ nav.accesskey }}"
                  title="{{ nav.title }} (Access key: Alt+Shift+{{ nav.accesskey | upcase }} on Windows, Control+Option+{{ nav.accesskey | upcase }} on macOS)"
                  {% if is_current %}aria-current="page"{% endif %}
                >
                  <span class="accesskey-letter">{{ nav.accesskey_label }}</span><span class="accesskey-rest">{{ nav.accesskey_rest }}</span>
                </a>
              </li>
            {% endfor %}
          </ul>
        </nav>
      </div>

      <main
        id="content"
        role="main"
        data-pagefind-body
        data-pagefind-title="{{ clean_title | default: site.name }}"
      >
        <span data-pagefind-meta="title" hidden>{{ clean_title | default: site.name }}</span>
        {% include anchor_headings.html html=content beforeHeading=true
        anchorClass="anchor" anchorBody="#" anchorTitle="link to subheading"
        h_min=2 %}
      </main>
    </div>

    <footer id="footer">
      <p>
        Copyright &copy; 2000-{{ site.time | date: '%Y' }}
        <a rel="author" href="{{ site.url }}/about/"
          ><em><abbr title="Peter Alexander Johns">paj</abbr></em></a
        >
        All rights (and some wrongs) reserved.
      </p>
      <p>
        Hosted by <a href="https://github.com">GitHub</a>, powered by
        <a href="https://jekyllrb.com">Jekyll</a>.
      </p>
    </footer>

    <script src="{{ site.url }}/assets/js/mobile-menu.min.js" defer></script>
    <script>
      // Simple lazy loading for images with .lazy class
      if ('IntersectionObserver' in window) {
        const images = document.querySelectorAll('img.lazy');
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const img = entry.target;
              img.classList.add('loaded');
              observer.unobserve(img);
            }
          });
        });
        images.forEach(img => observer.observe(img));
      } else {
        // Fallback for browsers without IntersectionObserver
        document.querySelectorAll('img.lazy').forEach(img => img.classList.add('loaded'));
      }
    </script>
    {% if page.url == '/blog/' %}
      <script src="{{ site.url }}/assets/js/blog-entry-flash.min.js" defer></script>
      <script>
        if ("serviceWorker" in navigator) {
          navigator.serviceWorker
            .register("/blog-entry-sw.min.js", { scope: "/blog/" })
            .catch(function (error) {
              if (window && window.console && console.error) {
                console.error("Service worker registration failed", error);
              }
            });
        }
      </script>
    {% endif %}
    {% if page.url == '/404.html' %}
      <script src="{{ site.url }}/assets/js/404.min.js"></script>
    {% endif %}

    {% include breadcrumb-schema.html %}
  </body>
</html>
