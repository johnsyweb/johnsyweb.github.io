{% comment %}
  Renders a parkrun utility card with configurable content and SEO markup.
  Usage: {% include utility-card.html card=card heading_level=2 %}
  
  WebP images are auto-generated from utility ID:
  - WebP path: /assets/images/webp/[id].webp
  - Image can be external URL or local path
{% endcomment %}
{% assign heading_level = include.heading_level | default: 2 %}
{% comment %} Auto-generate WebP path from utility ID (unless explicitly provided) {% endcomment %}
{% if include.card.image_webp %}
  {% assign webp_path = include.card.image_webp %}
{% else %}
  {% assign webp_path = '/assets/images/webp/' | append: include.card.id | append: '.webp' %}
{% endif %}
<div class="utility-card" data-utility-id="{{ include.card.id }}">
  <h{{ heading_level }}><a href="{{ include.card.url }}">{{ include.card.title }}</a></h{{ heading_level }}>
  <picture>
    <source 
      srcset="/assets/images/webp/{{ include.card.id }}.webp 1x, /assets/images/webp/{{ include.card.id }}@2x.webp 2x"
      type="image/webp"
    />
    <img 
      src="/assets/images/webp/{{ include.card.id }}.webp"
      srcset="/assets/images/webp/{{ include.card.id }}.webp 1x, /assets/images/webp/{{ include.card.id }}@2x.webp 2x"
      width="289" height="152"
      alt="{{ include.card.image_alt }}"
      {% if include.card.image_title %}title="{{ include.card.image_title }}"{% endif %}
      class="utility-preview"
      loading="lazy"
    />
  </picture>
  <p>{{ include.card.description }}</p>
  <div class="utility-meta">
    <p><strong>Purpose:</strong> {{ include.card.purpose }}</p>
    <p><strong>Features:</strong> {{ include.card.features | join: ', ' }}</p>
  </div>
  <p><a href="{{ include.card.url }}">Visit {{ include.card.title }} &rarr;</a></p>
  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "{{ include.card.seo.schema_type }}",
    "name": "{{ include.card.title }}",
    "description": "{{ include.card.description | strip_newlines | escape }}",
    "url": "{{ include.card.url }}",
    "image": "{{ include.card.image }}",
    "keywords": "{{ include.card.seo.keywords }}",
    "applicationCategory": "Utility",
    "operatingSystem": "Web Browser",
    "author": {% include schema-author.html %}
  }
  </script>
</div>
